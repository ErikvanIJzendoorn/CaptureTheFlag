{% block toernooi_info %}
    <div class="info_container">
        <div>
           <div id="myProgress">
              <div id="myBar"></div>
           </div>
        </div>
        <div class="text-container">
            <p id="float-left">
                :) = Vraag wordt nagekeken door een scheidsrechter
            </p>
            <h5 id="float-right">
                Ronde: 2
            </h5>
        </div>
    </div>
{% endblock %}

<script>

    const progress = (function ($) {
        let bar = null;
        let barPos = 0;

        const init = function () {
            bar = $('#myBar');
            timer = $('#timer');
            setInterval(update, 1000);
        }

        const update = function () {
            $.ajax({
                'url': 'timer',
                'dataType': 'json',
                'async': true,
                'success': function (data) {
                    calculateBar(data);
                    calculateTime(data);
                }
            });
        }

        const calculateBar = function (clock) {
            if (clock.active == 1) {
                const starttime = new Date(Date.parse(clock.start_time));
                const endtime = new Date(Date.parse(clock.endtime));

                range = endtime - starttime;
                diff = Math.max(0, endtime - new Date());

                barPos = (100 - 100 * diff / range);

                bar.css('background-color', 'green');
            }
            else {
                barPos = 100;
                bar.css('background-color', 'maroon');
            }

            setBar(barPos);
        }

        const calculateTime = function (clock) {
            if (clock.active == 1) {
                endtime = new Date(Date.parse(clock.endtime));
                now = Date.now();

                diffInSec = Math.round((endtime - now) / 1000);

                timeLeft = new Date(diffInSec * 1000).toISOString().substr(11, 8);
            }
            else {
                if (clock.set == 1) {
                    const current_timer_time = clock.current_timer_time;
                    timeLeft = current_timer_time.substr(3, 5) + "<i> - Pauze</i>";
                }
                else {
                    timeLeft = "00:00:00";
                }
            }
                
            timer.html(timeLeft);
        }

        const setBar = function (percentage) {
            bar.css('width', percentage + '%');
        }

        return {
            init: init
        }

    })(jQuery);

    $(function () {
        progress.init();
    });

</script>

<style>
    #myBar {
        transition: .1s;
    }
</style>
